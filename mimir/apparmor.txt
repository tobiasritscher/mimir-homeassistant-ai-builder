#include <tunables/global>

profile mimir flags=(attach_disconnected,mediate_deleted) {
  #include <abstractions/base>

  # Receive signals from supervisor
  signal receive set=(kill,term) peer=@{profile_name},

  # Allow reading configuration
  /data/** rw,
  /data/ r,

  # Allow access to Home Assistant config
  /config/** rw,
  /config/ r,

  # Allow access to share directory
  /share/** rw,
  /share/ r,

  # Allow SSL certificates (read-only)
  /ssl/** r,
  /ssl/ r,

  # Allow network access for LLM APIs and web search
  network inet stream,
  network inet6 stream,
  network inet dgram,
  network inet6 dgram,

  # Allow Unix sockets for internal communication
  network unix stream,
  network unix dgram,

  # Python and application files
  /app/** r,
  /usr/lib/python*/** r,
  /usr/local/lib/python*/** r,

  # Temporary files
  /tmp/** rw,
  /var/tmp/** rw,

  # Proc filesystem
  @{PROC}/@{pid}/fd/ r,
  @{PROC}/@{pid}/stat r,
  @{PROC}/@{pid}/cmdline r,

  # Git operations
  /usr/bin/git rix,
  /usr/libexec/git-core/** rix,
}
